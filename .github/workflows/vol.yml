name: EnquÃªte SuperPrix

on: push

jobs:
  policier-scene:
    name: Policier - ScÃ¨ne de crime
    runs-on: ubuntu-latest
    outputs:
      empreinte: empreinte trouvÃ©e sur la caisse
    steps:
      - name: Analyse de la scÃ¨ne
        run: |
          echo "Le policier examine la caisse enregistreuse"
          echo "Empreinte prÃ©levÃ©e sur la caisse"

  policier-video:
    name: Policier - Analyse vidÃ©o
    runs-on: ubuntu-latest
    outputs:
      video: ${{ steps.video-step.outputs.resultat }}
    steps:
      - name: RÃ©cupÃ©ration des vidÃ©os
        id: video-step
        run: echo "resultat=SÃ©quence vidÃ©o 22h15-22h45 rÃ©cupÃ©rÃ©e" >> $GITHUB_OUTPUT

  detective:
    name: DÃ©tective
    runs-on: ubuntu-latest
    needs:
      - policier-scene
      - policier-video
    outputs:
      rapport: ${{ steps.conclusion-step.outputs.conclusion }}
      lieu_arrestation: ${{ steps.conclusion-step.outputs.lieu }}
      autorisation_arrestation: ${{ steps.conclusion-step.outputs.autorisation }}
    steps:
      - name: Afficher les indices
        run: |
          echo "Indice empreinte: ${{ needs.policier-scene.outputs.empreinte }}"
          echo "Indice vidÃ©o: ${{ needs.policier-video.outputs.video }}"

      - name: Analyse des indices
        run: |
          echo "ANALYSE_EMPREINTE=Empreinte correspond Ã  un suspect connu" >> $GITHUB_ENV
          echo "ANALYSE_VIDEO=Suspect identifiÃ© sur la vidÃ©o Ã  22h30" >> $GITHUB_ENV

      - name: RÃ©daction du rapport
        id: conclusion-step
        run: |
          echo "conclusion=${ANALYSE_EMPREINTE}, ${ANALYSE_VIDEO}, suspect identifiÃ©" >> $GITHUB_OUTPUT
          echo "lieu=42 Avenue du Commerce, SupermarchÃ© SuperPrix" >> $GITHUB_OUTPUT
          echo "autorisation=true" >> $GITHUB_OUTPUT

  police:
    name: Ã‰quipe d'intervention
    runs-on: ubuntu-latest
    needs: detective
    steps:
      - name: Lecture du rapport
        run: |
          echo "Rapport: ${{ needs.detective.outputs.rapport }}"
          echo "Lieu: ${{ needs.detective.outputs.lieu_arrestation }}"
          echo "Autorisation: ${{ needs.detective.outputs.autorisation_arrestation }}"

      - name: EnquÃªte sans suite
        if: needs.detective.outputs.autorisation_arrestation != 'true'
        run: echo "Pas d'autorisation d'arrestation. EnquÃªte classÃ©e sans suite."

      - name: Arrestation du suspect
        if: needs.detective.outputs.autorisation_arrestation == 'true'
        run: echo "Le suspect a Ã©tÃ© arrÃªtÃ© au SupermarchÃ© SuperPrix ! ğŸš”"
